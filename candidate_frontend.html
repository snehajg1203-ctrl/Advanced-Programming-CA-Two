<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudentConnect</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        .hidden { display: none !important; }
        
        .auth-screen { min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 400px; width: 100%; padding: 40px; }
        .logo { width: 60px; height: 60px; background: #667eea; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 30px; }
        h1 { font-size: 28px; color: #333; text-align: center; }
        .subtitle { color: #666; margin: 8px 0 30px; text-align: center; }
        
        .user-toggle { display: flex; gap: 10px; margin-bottom: 25px; }
        .user-toggle button { flex: 1; padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; background: #f0f0f0; color: #666; }
        .user-toggle button.active { background: #667eea; color: white; }
        
        .form-group { margin-bottom: 16px; }
        input, select, textarea { width: 100%; padding: 14px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 15px; }
        input:focus { outline: none; border-color: #667eea; }
        .btn-primary { width: 100%; padding: 14px; background: #667eea; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn-primary:hover { background: #5568d3; }
        .link-btn { width: 100%; text-align: center; margin-top: 20px; color: #667eea; font-weight: 600; cursor: pointer; background: none; border: none; }
        .error { background: #fee; color: #c33; padding: 12px; border-radius: 8px; margin-bottom: 16px; }
        
        .dashboard { min-height: 100vh; background: #f5f5f5; }
        .navbar { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; }
        .nav-brand { font-size: 24px; font-weight: bold; color: #333; }
        .avatar { width: 40px; height: 40px; background: #667eea; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .btn-logout { padding: 8px 16px; color: #c33; border: 2px solid #c33; background: white; border-radius: 8px; cursor: pointer; font-weight: 600; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid; }
        .stat-card.blue { border-color: #667eea; }
        .stat-card.green { border-color: #10b981; }
        .stat-label { color: #666; font-size: 14px; margin-bottom: 8px; }
        .stat-value { font-size: 36px; font-weight: bold; color: #333; }
        
        .tabs { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .tab-buttons { display: flex; border-bottom: 2px solid #f0f0f0; }
        .tab-buttons button { flex: 1; padding: 16px; border: none; background: none; font-size: 16px; font-weight: 600; color: #666; cursor: pointer; border-bottom: 3px solid transparent; }
        .tab-buttons button.active { color: #667eea; border-bottom-color: #667eea; }
        .tab-content { display: none; padding: 24px; }
        .tab-content.active { display: block; }
        
        .btn-add { padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; margin-bottom: 20px; float: right; }
        .job-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 20px; clear: both; }
        .job-card { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .job-title { font-size: 20px; font-weight: bold; color: #333; }
        .job-company { color: #667eea; font-weight: 600; margin: 4px 0; }
        .job-type { padding: 6px 12px; background: #e0e7ff; color: #667eea; border-radius: 20px; font-size: 13px; font-weight: 600; }
        .btn-apply { width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 12px; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 16px; max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 24px; border-bottom: 2px solid #f0f0f0; }
        .modal-body { padding: 24px; }
        .close-btn { width: 32px; height: 32px; border: none; background: #f0f0f0; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="loginScreen" class="auth-screen">
        <div class="auth-card">
            <div class="logo">üíº</div>
            <h1>StudentConnect</h1>
            <p class="subtitle">Part-Time Jobs & References</p>
            
            <div class="user-toggle">
                <button id="studentLoginBtn" class="active" onclick="setLoginType('student')">Student</button>
                <button id="employerLoginBtn" onclick="setLoginType('employer')">Employer</button>
            </div>
            
            <form onsubmit="handleLogin(event)">
                <div id="loginError" class="error hidden"></div>
                <div class="form-group"><input type="email" id="loginEmail" placeholder="Email" required></div>
                <div class="form-group"><input type="password" id="loginPassword" placeholder="Password" required></div>
                <button type="submit" class="btn-primary">Sign In</button>
            </form>
            <button class="link-btn" onclick="showRegister()">Don't have an account? Register</button>
        </div>
    </div>

    <div id="registerScreen" class="auth-screen hidden">
        <div class="auth-card">
            <h1>Create Account</h1>
            <div class="user-toggle">
                <button id="studentRegBtn" class="active" onclick="setRegisterType('student')">Student</button>
                <button id="employerRegBtn" onclick="setRegisterType('employer')">Employer</button>
            </div>
            
            <form onsubmit="handleRegister(event)">
                <div id="registerError" class="error hidden"></div>
                <div class="form-group"><input type="text" id="regName" placeholder="Full Name" required></div>
                <div class="form-group hidden" id="companyField"><input type="text" id="regCompany" placeholder="Company Name"></div>
                <div class="form-group"><input type="email" id="regEmail" placeholder="Email" required></div>
                <div class="form-group"><input type="password" id="regPassword" placeholder="Password" required></div>
                <div class="form-group"><input type="tel" id="regPhone" placeholder="Phone"></div>
                <div id="studentFields">
                    <div class="form-group"><input type="text" id="regUniversity" placeholder="University"></div>
                    <div class="form-group"><input type="text" id="regMajor" placeholder="Major"></div>
                    <div class="form-group"><input type="number" id="regYear" placeholder="Year of Study" min="1" max="6"></div>
                </div>
                <button type="submit" class="btn-primary">Register</button>
            </form>
            <button class="link-btn" onclick="showLogin()">Already have an account? Login</button>
        </div>
    </div>

    <div id="dashboard" class="dashboard hidden">
        <nav class="navbar">
            <div class="nav-brand">üíº StudentConnect</div>
            <div style="display: flex; align-items: center; gap: 16px;">
                <span id="userName"></span>
                <div class="avatar" id="userAvatar"></div>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
        </nav>

        <div class="container">
            <div id="statsSection" class="stats"></div>
            <div class="tabs">
                <div class="tab-buttons" id="tabButtons"></div>
                <div id="tabContent"></div>
            </div>
        </div>
    </div>

    <div id="modal" class="modal"></div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        let currentUser = null;
        let loginType = 'student';
        let registerType = 'student';

        function setLoginType(type) {
            loginType = type;
            document.getElementById('studentLoginBtn').classList.toggle('active', type === 'student');
            document.getElementById('employerLoginBtn').classList.toggle('active', type === 'employer');
        }

        function setRegisterType(type) {
            registerType = type;
            document.getElementById('studentRegBtn').classList.toggle('active', type === 'student');
            document.getElementById('employerRegBtn').classList.toggle('active', type === 'employer');
            document.getElementById('studentFields').classList.toggle('hidden', type !== 'student');
            document.getElementById('companyField').classList.toggle('hidden', type !== 'employer');
        }

        function showRegister() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch(`${API_URL}/auth/login/${loginType}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({email, password})
                });
                
                const data = await response.json();
                if (data.success) {
                    currentUser = data.user;
                    showDashboard();
                } else {
                    document.getElementById('loginError').textContent = data.message;
                    document.getElementById('loginError').classList.remove('hidden');
                }
            } catch (error) {
                alert('Error connecting to server. Please ensure backend is running on port 5000');
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const data = {
                name: registerType === 'employer' ? document.getElementById('regCompany').value : document.getElementById('regName').value,
                email: document.getElementById('regEmail').value,
                password: document.getElementById('regPassword').value,
                phone: document.getElementById('regPhone').value
            };
            
            if (registerType === 'student') {
                data.university = document.getElementById('regUniversity').value;
                data.major = document.getElementById('regMajor').value;
                data.year = document.getElementById('regYear').value;
            } else {
                data.company = data.name;
            }
            
            try {
                const response = await fetch(`${API_URL}/auth/register/${registerType}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    alert('Registration successful! Please login.');
                    showLogin();
                } else {
                    document.getElementById('registerError').textContent = result.message;
                    document.getElementById('registerError').classList.remove('hidden');
                }
            } catch (error) {
                alert('Error connecting to server');
            }
        }

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0);
            
            renderDashboard();
        }

        async function renderDashboard() {
            if (currentUser.type === 'student') {
                const apps = await fetchApplications();
                const refs = await fetchReferences();
                
                document.getElementById('statsSection').innerHTML = `
                    <div class="stat-card blue"><div class="stat-label">Applications</div><div class="stat-value">${apps.length}</div></div>
                    <div class="stat-card green"><div class="stat-label">References</div><div class="stat-value">${refs.length}</div></div>
                `;
                
                document.getElementById('tabButtons').innerHTML = `
                    <button class="active" onclick="showTab('jobs')">Jobs</button>
                    <button onclick="showTab('applications')">Applications</button>
                    <button onclick="showTab('references')">References</button>
                `;
            } else {
                document.getElementById('tabButtons').innerHTML = `
                    <button class="active" onclick="showTab('jobs')">My Jobs</button>
                `;
            }
            showTab('jobs');
        }

        async function showTab(tab) {
            document.querySelectorAll('.tab-buttons button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const content = document.getElementById('tabContent');
            content.innerHTML = '<div class="tab-content active" id="activeTab">Loading...</div>';
            
            const tabDiv = document.getElementById('activeTab');
            
            if (tab === 'jobs') {
                const jobs = await fetchJobs();
                if (currentUser.type === 'employer') {
                    tabDiv.innerHTML = '<button class="btn-add" onclick="showAddJobModal()">+ Post New Job</button>';
                }
                const grid = document.createElement('div');
                grid.className = 'job-grid';
                jobs.forEach(job => {
                    grid.innerHTML += `
                        <div class="job-card">
                            <div class="job-title">${job.title}</div>
                            <div class="job-company">${job.company}</div>
                            <span class="job-type">${job.type}</span>
                            <p style="margin: 12px 0; color: #666;">${job.description}</p>
                            <div style="margin: 12px 0;">üìç ${job.location} | üí∞ ${job.salary}</div>
                            ${currentUser.type === 'student' ? `<button class="btn-apply" onclick="applyJob(${job.id}, '${job.title}', '${job.company}')">Apply Now</button>` : ''}
                        </div>
                    `;
                });
                tabDiv.appendChild(grid);
            } else if (tab === 'applications') {
                const apps = await fetchApplications();
                tabDiv.innerHTML = apps.length ? apps.map(app => `
                    <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 16px;">
                        <h3>${app.job_title}</h3>
                        <p style="color: #666;">${app.company} ‚Ä¢ Applied: ${new Date(app.applied_date).toLocaleDateString()}</p>
                        <span style="padding: 6px 12px; background: #fef3c7; color: #92400e; border-radius: 20px; font-size: 13px;">${app.status}</span>
                    </div>
                `).join('') : '<p style="text-align:center;padding:40px;color:#666;">No applications yet</p>';
            } else if (tab === 'references') {
                tabDiv.innerHTML = '<button class="btn-add" onclick="showAddRefModal()">+ Request Reference</button>';
                const refs = await fetchReferences();
                refs.forEach(ref => {
                    tabDiv.innerHTML += `
                        <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 16px;">
                            <h3>${ref.referee_name}</h3>
                            <p style="color: #666;">${ref.relationship} at ${ref.company}</p>
                            <span style="padding: 6px 12px; background: ${ref.status === 'completed' ? '#d1fae5' : '#fef3c7'}; color: ${ref.status === 'completed' ? '#065f46' : '#92400e'}; border-radius: 20px; font-size: 13px;">${ref.status}</span>
                        </div>
                    `;
                });
            }
        }

        async function fetchJobs() {
            const response = await fetch(`${API_URL}/jobs`);
            const data = await response.json();
            return data.jobs || [];
        }

        async function fetchApplications() {
            const response = await fetch(`${API_URL}/applications/student/${currentUser.id}`);
            const data = await response.json();
            return data.applications || [];
        }

        async function fetchReferences() {
            const response = await fetch(`${API_URL}/references/student/${currentUser.id}`);
            const data = await response.json();
            return data.references || [];
        }

        async function applyJob(jobId, title, company) {
            const response = await fetch(`${API_URL}/applications`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    job_id: jobId,
                    student_id: currentUser.id,
                    job_title: title,
                    company: company
                })
            });
            const data = await response.json();
            alert(data.message);
            if (data.success) showTab('applications');
        }

        function showAddRefModal() {
            document.getElementById('modal').innerHTML = `
                <div class="modal-content">
                    <div class="modal-header"><h2>Request Reference</h2><button class="close-btn" onclick="closeModal()">‚úï</button></div>
                    <div class="modal-body">
                        <form onsubmit="addReference(event)">
                            <div class="form-group"><input type="text" id="refName" placeholder="Referee Name" required></div>
                            <div class="form-group"><input type="email" id="refEmail" placeholder="Referee Email" required></div>
                            <div class="form-group"><input type="text" id="refRelationship" placeholder="Relationship" required></div>
                            <div class="form-group"><input type="text" id="refCompany" placeholder="Company" required></div>
                            <button type="submit" class="btn-primary">Send Request</button>
                        </form>
                    </div>
                </div>
            `;
            document.getElementById('modal').classList.add('show');
        }

        function showAddJobModal() {
            document.getElementById('modal').innerHTML = `
                <div class="modal-content">
                    <div class="modal-header"><h2>Post New Job</h2><button class="close-btn" onclick="closeModal()">‚úï</button></div>
                    <div class="modal-body">
                        <form onsubmit="addJob(event)">
                            <div class="form-group"><input type="text" id="jobTitle" placeholder="Job Title" required></div>
                            <div class="form-group"><textarea id="jobDesc" placeholder="Description" required></textarea></div>
                            <div class="form-group"><input type="text" id="jobLocation" placeholder="Location" required></div>
                            <div class="form-group"><input type="text" id="jobSalary" placeholder="Salary (e.g., ‚Ç¨15-20/hr)"></div>
                            <button type="submit" class="btn-primary">Post Job</button>
                        </form>
                    </div>
                </div>
            `;
            document.getElementById('modal').classList.add('show');
        }

        async function addReference(e) {
            e.preventDefault();
            const response = await fetch(`${API_URL}/references`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    student_id: currentUser.id,
                    referee_name: document.getElementById('refName').value,
                    referee_email: document.getElementById('refEmail').value,
                    relationship: document.getElementById('refRelationship').value,
                    company: document.getElementById('refCompany').value
                })
            });
            const data = await response.json();
            alert(data.message);
            closeModal();
            showTab('references');
        }

        async function addJob(e) {
            e.preventDefault();
            const response = await fetch(`${API_URL}/jobs`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    title: document.getElementById('jobTitle').value,
                    company: currentUser.name,
                    description: document.getElementById('jobDesc').value,
                    location: document.getElementById('jobLocation').value,
                    salary: document.getElementById('jobSalary').value,
                    type: 'part-time',
                    employer_id: currentUser.id
                })
            });
            const data = await response.json();
            alert(data.message);
            closeModal();
            showTab('jobs');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }

        function logout() {
            currentUser = null;
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        }
    </script>
</body>
</html>