<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - StudentConnect</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; }
        .hidden { display: none !important; }
        
        .admin-login { min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; padding: 20px; }
        .login-card { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 400px; width: 100%; padding: 40px; }
        .admin-logo { width: 80px; height: 80px; background: #667eea; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 36px; }
        h1 { font-size: 28px; color: #333; text-align: center; margin-bottom: 30px; }
        
        input { width: 100%; padding: 14px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 15px; margin-bottom: 16px; }
        input:focus { outline: none; border-color: #667eea; }
        .btn-login { width: 100%; padding: 14px; background: #667eea; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .error { background: #fee; color: #c33; padding: 12px; border-radius: 8px; margin-bottom: 16px; }
        
        .dashboard { min-height: 100vh; }
        .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 260px; background: #1f2937; color: white; padding: 20px; overflow-y: auto; }
        .sidebar-title { font-size: 20px; font-weight: bold; margin-bottom: 40px; }
        .nav-link { display: block; padding: 12px 16px; border-radius: 10px; color: #9ca3af; text-decoration: none; margin-bottom: 8px; cursor: pointer; }
        .nav-link:hover { background: #374151; color: white; }
        .nav-link.active { background: #667eea; color: white; }
        
        .main-content { margin-left: 260px; padding: 20px; }
        .top-bar { background: white; border-radius: 12px; padding: 20px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .page-title { font-size: 28px; font-weight: bold; color: #333; }
        .btn-logout { padding: 8px 20px; background: white; color: #c33; border: 2px solid #c33; border-radius: 8px; font-weight: 600; cursor: pointer; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid; }
        .stat-card.blue { border-color: #667eea; }
        .stat-card.green { border-color: #10b981; }
        .stat-card.purple { border-color: #8b5cf6; }
        .stat-card.orange { border-color: #f59e0b; }
        .stat-value { font-size: 36px; font-weight: bold; color: #333; }
        .stat-label { color: #666; font-size: 14px; }
        
        .content-card { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; background: #f9fafb; font-weight: 600; border-bottom: 2px solid #e0e0e0; }
        td { padding: 12px; border-bottom: 1px solid #f0f0f0; }
        .badge { padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; }
        .badge.student { background: #dbeafe; color: #1e40af; }
        .badge.employer { background: #fce7f3; color: #9f1239; }
        .badge.pending { background: #fef3c7; color: #92400e; }
        .badge.completed { background: #d1fae5; color: #065f46; }
        .loading { text-align: center; padding: 40px; color: #666; }
    </style>
</head>
<body>
    <div id="loginScreen" class="admin-login">
        <div class="login-card">
            <div class="admin-logo">üîê</div>
            <h1>Admin Dashboard</h1>
            <form onsubmit="handleLogin(event)">
                <div id="loginError" class="error hidden"></div>
                <input type="text" id="adminUsername" placeholder="Admin Username" required>
                <input type="password" id="adminPassword" placeholder="Admin Password" required>
                <button type="submit" class="btn-login">Sign In</button>
            </form>
            <p style="text-align:center;color:#999;font-size:13px;margin-top:20px;">Default: admin / admin123</p>
        </div>
    </div>

    <div id="dashboard" class="dashboard hidden">
        <aside class="sidebar">
            <div class="sidebar-title">üìä Admin Panel</div>
            <a class="nav-link active" onclick="showSection('overview')">üìà Overview</a>
            <a class="nav-link" onclick="showSection('students')">üë®‚Äçüéì Students</a>
            <a class="nav-link" onclick="showSection('employers')">üè¢ Employers</a>
            <a class="nav-link" onclick="showSection('jobs')">üíº Jobs</a>
            <a class="nav-link" onclick="showSection('applications')">üìã Applications</a>
            <a class="nav-link" onclick="showSection('references')">üìÑ References</a>
        </aside>

        <main class="main-content">
            <div class="top-bar">
                <h2 class="page-title" id="pageTitle">Overview</h2>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
            <div id="contentArea"></div>
        </main>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        const ADMIN_USER = 'admin';
        const ADMIN_PASS = 'admin123';
        let allData = {users: [], jobs: [], applications: [], references: []};

        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            if (username === ADMIN_USER && password === ADMIN_PASS) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                loadAllData();
            } else {
                document.getElementById('loginError').textContent = 'Invalid credentials';
                document.getElementById('loginError').classList.remove('hidden');
            }
        }

        async function loadAllData() {
            try {
                // Fetch from API endpoints
                const [usersRes, jobsRes, appsRes, refsRes] = await Promise.all([
                    fetch(`${API_URL}/admin/users`),
                    fetch(`${API_URL}/jobs`),
                    fetch(`${API_URL}/applications`),
                    fetch(`${API_URL}/references`)
                ]);

                const usersData = await usersRes.json();
                const jobsData = await jobsRes.json();
                const appsData = await appsRes.json();
                const refsData = await refsRes.json();

                allData.users = usersData.users || [];
                allData.jobs = jobsData.jobs || [];
                allData.applications = appsData.applications || [];
                allData.references = refsData.references || [];

                showSection('overview');
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Error connecting to database. Please ensure backend is running.');
            }
        }

        function showSection(section) {
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
            
            const titles = {
                overview: 'Overview',
                students: 'Students Management',
                employers: 'Employers Management',
                jobs: 'Jobs Management',
                applications: 'Applications',
                references: 'References'
            };
            
            document.getElementById('pageTitle').textContent = titles[section];
            
            switch(section) {
                case 'overview': renderOverview(); break;
                case 'students': renderStudents(); break;
                case 'employers': renderEmployers(); break;
                case 'jobs': renderJobs(); break;
                case 'applications': renderApplications(); break;
                case 'references': renderReferences(); break;
            }
        }

        function renderOverview() {
            const students = allData.users.filter(u => u.type === 'student');
            const employers = allData.users.filter(u => u.type === 'employer');
            
            document.getElementById('contentArea').innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card blue">
                        <div class="stat-label">Total Students</div>
                        <div class="stat-value">${students.length}</div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-label">Total Employers</div>
                        <div class="stat-value">${employers.length}</div>
                    </div>
                    <div class="stat-card purple">
                        <div class="stat-label">Active Jobs</div>
                        <div class="stat-value">${allData.jobs.length}</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-label">Applications</div>
                        <div class="stat-value">${allData.applications.length}</div>
                    </div>
                </div>
                <div class="content-card">
                    <h3 style="margin-bottom: 20px;">Recent Activity</h3>
                    ${allData.applications.length > 0 ? `
                        <table>
                            <thead><tr><th>Type</th><th>Description</th><th>Date</th><th>Status</th></tr></thead>
                            <tbody>
                                ${allData.applications.slice(0, 10).map(app => `
                                    <tr>
                                        <td><span class="badge student">Application</span></td>
                                        <td>Application for ${app.job_title || 'Job'}</td>
                                        <td>${new Date(app.applied_date).toLocaleDateString()}</td>
                                        <td><span class="badge ${app.status}">${app.status}</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : '<p class="loading">No recent activity</p>'}
                </div>
            `;
        }

        function renderStudents() {
            const students = allData.users.filter(u => u.type === 'student');
            
            document.getElementById('contentArea').innerHTML = `
                <div class="content-card">
                    <h3 style="margin-bottom: 20px;">All Students (${students.length})</h3>
                    ${students.length > 0 ? `
                        <table>
                            <thead><tr><th>Name</th><th>Email</th><th>University</th><th>Major</th><th>Year</th><th>Joined</th></tr></thead>
                            <tbody>
                                ${students.map(s => `
                                    <tr>
                                        <td><strong>${s.name}</strong></td>
                                        <td>${s.email}</td>
                                        <td>${s.university || 'N/A'}</td>
                                        <td>${s.major || 'N/A'}</td>
                                        <td>Year ${s.year || 'N/A'}</td>
                                        <td>${new Date(s.created_at).toLocaleDateString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : '<p class="loading">No students found</p>'}
                </div>
            `;
        }

        function renderEmployers() {
            const employers = allData.users.filter(u => u.type === 'employer');
            
            document.getElementById('contentArea').innerHTML = `
                <div class="content-card">
                    <h3 style="margin-bottom: 20px;">All Employers (${employers.length})</h3>
                    ${employers.length > 0 ? `
                        <table>
                            <thead><tr><th>Company</th><th>Email</th><th>Phone</th><th>Jobs Posted</th><th>Joined</th></tr></thead>
                            <tbody>
                                ${employers.map(e => {
                                    const jobsCount = allData.jobs.filter(j => j.employer_id === e.id).length;
                                    return `
                                        <tr>
                                            <td><strong>${e.name}</strong></td>
                                            <td>${e.email}</td>
                                            <td>${e.phone || 'N/A'}</td>
                                            <td><span class="badge employer">${jobsCount} jobs</span></td>
                                            <td>${new Date(e.created_at).toLocaleDateString()}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    ` : '<p class="loading">No employers found</p>'}
                </div>
            `;
        }

        function renderJobs() {
            document.getElementById('contentArea').innerHTML = `
                <div class="content-card">
                    <h3 style="margin-bottom: 20px;">All Jobs (${allData.jobs.length})</h3>
                    ${allData.jobs.length > 0 ? `
                        <table>
                            <thead><tr><th>Job Title</th><th>Company</th><th>Type</th><th>Location</th><th>Applications</th></tr></thead>
                            <tbody>
                                ${allData.jobs.map(j => {
                                    const appsCount = allData.applications.filter(a => a.job_id === j.id).length;
                                    return `
                                        <tr>
                                            <td><strong>${j.title}</strong></td>
                                            <td>${j.company}</td>
                                            <td><span class="badge student">${j.type}</span></td>
                                            <td>${j.location}</td>
                                            <td>${appsCount}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    ` : '<p class="loading">No jobs found</p>'}
                </div>
            `;
        }

        function renderApplications() {
            document.getElementById('contentArea').innerHTML = `
                <div class="content-card">
                    <h3 style="margin-bottom: 20px;">All Applications (${allData.applications.length})</h3>
                    ${allData.applications.length > 0 ? `
                        <table>
                            <thead><tr><th>Student</th><th>Job Title</th><th>Company</th><th>Date</th><th>Status</th></tr></thead>
                            <tbody>
                                ${allData.applications.map(app => {
                                    const student = allData.users.find(u => u.id === app.student_id);
                                    return `
                                        <tr>
                                            <td>${student ? student.name : 'Unknown'}</td>
                                            <td>${app.job_title}</td>
                                            <td>${app.company}</td>
                                            <td>${new Date(app.applied_date).toLocaleDateString()}</td>
                                            <td><span class="badge ${app.status}">${app.status}</span></td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    ` : '<p class="loading">No applications found</p>'}
                </div>
            `;
        }

        function renderReferences() {
            document.getElementById('contentArea').innerHTML = `
                <div class="content-card">
                    <h3 style="margin-bottom: 20px;">All References (${allData.references.length})</h3>
                    ${allData.references.length > 0 ? `
                        <table>
                            <thead><tr><th>Student</th><th>Referee</th><th>Company</th><th>Date</th><th>Status</th></tr></thead>
                            <tbody>
                                ${allData.references.map(ref => {
                                    const student = allData.users.find(u => u.id === ref.student_id);
                                    return `
                                        <tr>
                                            <td>${student ? student.name : 'Unknown'}</td>
                                            <td>${ref.referee_name}</td>
                                            <td>${ref.company}</td>
                                            <td>${new Date(ref.request_date).toLocaleDateString()}</td>
                                            <td><span class="badge ${ref.status}">${ref.status}</span></td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    ` : '<p class="loading">No references found</p>'}
                </div>
            `;
        }

        function logout() {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
        }
    </script>
</body>
</html>